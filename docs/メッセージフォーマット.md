# メッセージフォーマット

タスク管理マスタとタスクワーカー間、および同一ツール内のスレッドと待ち受けループ間でやり取りするメッセージは、以下に示すように、key-valueペアをJSON形式にしたものとする。

## 基本フォーマット

* { "type": "<メッセージタイプ>", "msg": "<メッセージ内容>" }

## リクエストIDを含むフォーマット

タスク実行依頼やヘルスチェックなど、応答が必要なメッセージでは以下のフォーマットを使用する：

* { "type": "<メッセージタイプ>", "msg": "<メッセージ内容>", "req_id": "<リクエストID>" }

メッセージタイプには以下のものがある。

* JOIN: 参入
* JOIN_ACK: 参入応答
* REQUEST: タスク実行依頼
* REQUEST_ACK: タスク実行依頼承諾
* DONE: タスク完了報告
* FAILED: タスク失敗報告
* USAGE_LIMITED: タスク失敗報告（レートリミットに引っかかった）
* CHECK: ヘルスチェック
* CHECK_ACK: ヘルスチェック応答
* LEAVE: 離脱
* COMPLETED: 全タスク完了
* TIMER: タイマーイベント
* TIMEOUT_CHECK: ワーカー応答タイムアウトのチェック
* EXIT: プログラム停止（ループ終了）

## TCP通信時のメッセージ送信フォーマット

タスク管理マスタとタスクワーカー間のTCP通信では、各JSONメッセージの末尾に改行文字（\n）を付与して送信する。これにより、複数のメッセージが連結された場合でも正しく分離できる。

例：
```
{"type": "CHECK", "msg": "", "req_id": "check_1234"}\n
```

